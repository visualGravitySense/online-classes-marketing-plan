<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üìä –î–∞—à–±–æ—Ä–¥ "Digitalizacija Biznesa"</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary-color: #4ECDC4;
            --secondary-color: #45B7D1;
            --success-color: #96CEB4;
            --warning-color: #FFEAA7;
            --danger-color: #FF6B6B;
            --dark-color: #2C3E50;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .dashboard-container {
            min-height: 100vh;
            padding: 20px;
        }
        
        .header {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        
        .metric-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }
        
        .metric-card:hover {
            transform: translateY(-5px);
        }
        
        .metric-value {
            font-size: 2.5rem;
            font-weight: bold;
            color: var(--primary-color);
        }
        
        .metric-label {
            font-size: 1.1rem;
            color: var(--dark-color);
            margin-bottom: 10px;
        }
        
        .metric-change {
            font-size: 0.9rem;
            color: var(--success-color);
        }
        
        .metric-change.negative {
            color: var(--danger-color);
        }
        
        .chart-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        
        .table-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        
        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
        }
        
        .status-active {
            background-color: var(--success-color);
        }
        
        .status-pending {
            background-color: var(--warning-color);
        }
        
        .status-inactive {
            background-color: var(--danger-color);
        }
        
        .nav-tabs .nav-link {
            border: none;
            color: var(--dark-color);
            border-radius: 10px;
            margin-right: 5px;
        }
        
        .nav-tabs .nav-link.active {
            background-color: var(--primary-color);
            color: white;
        }
        
        .refresh-btn {
            background: var(--primary-color);
            border: none;
            border-radius: 10px;
            padding: 10px 20px;
            color: white;
            transition: all 0.3s ease;
        }
        
        .refresh-btn:hover {
            background: var(--secondary-color);
            transform: scale(1.05);
        }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
        <div class="header">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <h1><i class="fas fa-chart-line"></i> –î–∞—à–±–æ—Ä–¥ "Digitalizacija Biznesa"</h1>
                    <p class="text-muted mb-0">–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∫–∞–º–ø–∞–Ω–∏–∏ –ø–æ —Ü–∏—Ñ—Ä–æ–≤–∏–∑–∞—Ü–∏–∏ –±–∏–∑–Ω–µ—Å–∞</p>
                </div>
                <div class="col-md-4 text-end">
                    <button class="refresh-btn" onclick="refreshData()">
                        <i class="fas fa-sync-alt"></i> –û–±–Ω–æ–≤–∏—Ç—å
                    </button>
                    <p class="text-muted mt-2 mb-0">
                        <i class="fas fa-clock"></i> 
                        <span id="last-update">{{ last_update }}</span>
                    </p>
                </div>
            </div>
        </div>

        <!-- –û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ -->
        <div class="row">
            <div class="col-md-3">
                <div class="metric-card">
                    <div class="metric-label">
                        <i class="fas fa-users"></i> –í—Å–µ–≥–æ –ª–∏–¥–æ–≤
                    </div>
                    <div class="metric-value" id="total-leads">{{ total_leads }}</div>
                    <div class="metric-change" id="leads-change">
                        <i class="fas fa-arrow-up"></i> +{{ leads_growth }}% –∑–∞ –Ω–µ–¥–µ–ª—é
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="metric-card">
                    <div class="metric-label">
                        <i class="fas fa-chart-pie"></i> –ö–æ–Ω–≤–µ—Ä—Å–∏—è
                    </div>
                    <div class="metric-value" id="conversion-rate">{{ conversion_rate }}%</div>
                    <div class="metric-change" id="conversion-change">
                        <i class="fas fa-arrow-up"></i> +{{ conversion_growth }}% –∑–∞ –Ω–µ–¥–µ–ª—é
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="metric-card">
                    <div class="metric-label">
                        <i class="fas fa-eye"></i> –ü—Ä–æ—Å–º–æ—Ç—Ä—ã
                    </div>
                    <div class="metric-value" id="total-views">{{ total_views }}</div>
                    <div class="metric-change" id="views-change">
                        <i class="fas fa-arrow-up"></i> +{{ views_growth }}% –∑–∞ –Ω–µ–¥–µ–ª—é
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="metric-card">
                    <div class="metric-label">
                        <i class="fas fa-dollar-sign"></i> –î–æ—Ö–æ–¥
                    </div>
                    <div class="metric-value" id="total-revenue">${{ total_revenue }}</div>
                    <div class="metric-change" id="revenue-change">
                        <i class="fas fa-arrow-up"></i> +{{ revenue_growth }}% –∑–∞ –Ω–µ–¥–µ–ª—é
                    </div>
                </div>
            </div>
        </div>

        <!-- –ì—Ä–∞—Ñ–∏–∫–∏ –∏ —Ç–∞–±–ª–∏—Ü—ã -->
        <div class="row">
            <!-- –í–æ—Ä–æ–Ω–∫–∞ –ø—Ä–æ–¥–∞–∂ -->
            <div class="col-md-6">
                <div class="chart-container">
                    <h4><i class="fas fa-funnel"></i> –í–æ—Ä–æ–Ω–∫–∞ –ø—Ä–æ–¥–∞–∂</h4>
                    <canvas id="funnelChart" width="400" height="200"></canvas>
                </div>
            </div>
            
            <!-- –ö–æ–Ω–≤–µ—Ä—Å–∏–∏ –ø–æ –¥–Ω—è–º -->
            <div class="col-md-6">
                <div class="chart-container">
                    <h4><i class="fas fa-chart-line"></i> –ö–æ–Ω–≤–µ—Ä—Å–∏–∏ –ø–æ –¥–Ω—è–º</h4>
                    <canvas id="conversionsChart" width="400" height="200"></canvas>
                </div>
            </div>
        </div>

        <!-- –î–µ—Ç–∞–ª—å–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ -->
        <div class="row">
            <div class="col-md-12">
                <div class="table-container">
                    <ul class="nav nav-tabs" id="analyticsTabs" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="leads-tab" data-bs-toggle="tab" data-bs-target="#leads" type="button" role="tab">
                                <i class="fas fa-users"></i> –õ–∏–¥—ã
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="posts-tab" data-bs-toggle="tab" data-bs-target="#posts" type="button" role="tab">
                                <i class="fas fa-file-alt"></i> –ü–æ—Å—Ç—ã
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="channels-tab" data-bs-toggle="tab" data-bs-target="#channels" type="button" role="tab">
                                <i class="fas fa-broadcast-tower"></i> –ö–∞–Ω–∞–ª—ã
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="recommendations-tab" data-bs-toggle="tab" data-bs-target="#recommendations" type="button" role="tab">
                                <i class="fas fa-lightbulb"></i> –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
                            </button>
                        </li>
                    </ul>
                    
                    <div class="tab-content" id="analyticsTabsContent">
                        <!-- –õ–∏–¥—ã -->
                        <div class="tab-pane fade show active" id="leads" role="tabpanel">
                            <div class="row mt-3">
                                <div class="col-md-6">
                                    <h5>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Å—Ç–∞–¥–∏—è–º</h5>
                                    <div class="table-responsive">
                                        <table class="table table-hover">
                                            <thead>
                                                <tr>
                                                    <th>–°—Ç–∞–¥–∏—è</th>
                                                    <th>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</th>
                                                    <th>–ü—Ä–æ—Ü–µ–Ω—Ç</th>
                                                </tr>
                                            </thead>
                                            <tbody id="funnel-table">
                                                {% for stage in funnel_data %}
                                                <tr>
                                                    <td>
                                                        <span class="status-indicator status-active"></span>
                                                        {{ stage.stage_name }}
                                                    </td>
                                                    <td>{{ stage.count }}</td>
                                                    <td>{{ stage.percentage }}%</td>
                                                </tr>
                                                {% endfor %}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <h5>–ò—Å—Ç–æ—á–Ω–∏–∫–∏ –ª–∏–¥–æ–≤</h5>
                                    <div class="table-responsive">
                                        <table class="table table-hover">
                                            <thead>
                                                <tr>
                                                    <th>–ò—Å—Ç–æ—á–Ω–∏–∫</th>
                                                    <th>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</th>
                                                    <th>–ö–æ–Ω–≤–µ—Ä—Å–∏—è</th>
                                                </tr>
                                            </thead>
                                            <tbody id="sources-table">
                                                {% for source in sources_data %}
                                                <tr>
                                                    <td>{{ source.source }}</td>
                                                    <td>{{ source.count }}</td>
                                                    <td>{{ source.conversion }}%</td>
                                                </tr>
                                                {% endfor %}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- –ü–æ—Å—Ç—ã -->
                        <div class="tab-pane fade" id="posts" role="tabpanel">
                            <div class="row mt-3">
                                <div class="col-md-6">
                                    <h5>–¢–∏–ø—ã –ø–æ—Å—Ç–æ–≤</h5>
                                    <canvas id="postTypesChart" width="300" height="200"></canvas>
                                </div>
                                <div class="col-md-6">
                                    <h5>–í–æ–≤–ª–µ—á–µ–Ω–Ω–æ—Å—Ç—å</h5>
                                    <div class="table-responsive">
                                        <table class="table table-hover">
                                            <thead>
                                                <tr>
                                                    <th>–ú–µ—Ç—Ä–∏–∫–∞</th>
                                                    <th>–ó–Ω–∞—á–µ–Ω–∏–µ</th>
                                                    <th>–ò–∑–º–µ–Ω–µ–Ω–∏–µ</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <td>–°—Ä–µ–¥–Ω–∏–µ –ø—Ä–æ—Å–º–æ—Ç—Ä—ã</td>
                                                    <td>{{ avg_views }}</td>
                                                    <td class="text-success">+{{ views_change }}%</td>
                                                </tr>
                                                <tr>
                                                    <td>–°—Ä–µ–¥–Ω–∏–µ –ª–∞–π–∫–∏</td>
                                                    <td>{{ avg_likes }}</td>
                                                    <td class="text-success">+{{ likes_change }}%</td>
                                                </tr>
                                                <tr>
                                                    <td>–°—Ä–µ–¥–Ω–∏–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏</td>
                                                    <td>{{ avg_comments }}</td>
                                                    <td class="text-success">+{{ comments_change }}%</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- –ö–∞–Ω–∞–ª—ã -->
                        <div class="tab-pane fade" id="channels" role="tabpanel">
                            <div class="row mt-3">
                                <div class="col-md-12">
                                    <h5>–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∫–∞–Ω–∞–ª–æ–≤</h5>
                                    <div class="table-responsive">
                                        <table class="table table-hover">
                                            <thead>
                                                <tr>
                                                    <th>–ö–∞–Ω–∞–ª</th>
                                                    <th>–ü–æ–¥–ø–∏—Å—á–∏–∫–∏</th>
                                                    <th>–ü–æ—Å—Ç—ã</th>
                                                    <th>–ü—Ä–æ—Å–º–æ—Ç—Ä—ã</th>
                                                    <th>–í–æ–≤–ª–µ—á–µ–Ω–Ω–æ—Å—Ç—å</th>
                                                    <th>–°—Ç–∞—Ç—É—Å</th>
                                                </tr>
                                            </thead>
                                            <tbody id="channels-table">
                                                {% for channel in channels_data %}
                                                <tr>
                                                    <td>{{ channel.name }}</td>
                                                    <td>{{ channel.subscribers }}</td>
                                                    <td>{{ channel.posts }}</td>
                                                    <td>{{ channel.views }}</td>
                                                    <td>{{ channel.engagement }}%</td>
                                                    <td>
                                                        <span class="status-indicator status-active"></span>
                                                        –ê–∫—Ç–∏–≤–µ–Ω
                                                    </td>
                                                </tr>
                                                {% endfor %}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ -->
                        <div class="tab-pane fade" id="recommendations" role="tabpanel">
                            <div class="row mt-3">
                                <div class="col-md-12">
                                    <h5>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —É–ª—É—á—à–µ–Ω–∏—é</h5>
                                    <div id="recommendations-list">
                                        {% for recommendation in recommendations %}
                                        <div class="alert alert-info">
                                            <i class="fas fa-lightbulb"></i>
                                            {{ recommendation }}
                                        </div>
                                        {% endfor %}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // –î–∞–Ω–Ω—ã–µ –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–æ–≤
        const funnelData = {
            labels: ['–û—Å–≤–µ–¥–æ–º–ª–µ–Ω–Ω–æ—Å—Ç—å', '–ò–Ω—Ç–µ—Ä–µ—Å', '–†–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–µ', '–ù–∞–º–µ—Ä–µ–Ω–∏–µ', '–ü–æ–∫—É–ø–∫–∞'],
            datasets: [{
                label: '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ª–∏–¥–æ–≤',
                data: [{{ funnel_chart_data }}],
                backgroundColor: [
                    '#FF6B6B',
                    '#4ECDC4', 
                    '#45B7D1',
                    '#96CEB4',
                    '#FFEAA7'
                ],
                borderWidth: 2
            }]
        };

        const conversionsData = {
            labels: [{{ conversions_chart_labels }}],
            datasets: [{
                label: '–ö–æ–Ω–≤–µ—Ä—Å–∏–∏',
                data: [{{ conversions_chart_data }}],
                borderColor: '#4ECDC4',
                backgroundColor: 'rgba(78, 205, 196, 0.1)',
                tension: 0.4,
                fill: true
            }]
        };

        const postTypesData = {
            labels: [{{ post_types_labels }}],
            datasets: [{
                label: '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ—Å—Ç–æ–≤',
                data: [{{ post_types_data }}],
                backgroundColor: [
                    '#FF6B6B',
                    '#4ECDC4',
                    '#45B7D1', 
                    '#96CEB4'
                ]
            }]
        };

        // –°–æ–∑–¥–∞–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–æ–≤
        const funnelChart = new Chart(document.getElementById('funnelChart'), {
            type: 'doughnut',
            data: funnelData,
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        position: 'bottom'
                    }
                }
            }
        });

        const conversionsChart = new Chart(document.getElementById('conversionsChart'), {
            type: 'line',
            data: conversionsData,
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        display: false
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });

        const postTypesChart = new Chart(document.getElementById('postTypesChart'), {
            type: 'pie',
            data: postTypesData,
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        position: 'bottom'
                    }
                }
            }
        });

        // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
        function refreshData() {
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
            document.querySelector('.refresh-btn i').classList.add('fa-spin');
            
            // –ò–º–∏—Ç–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
            setTimeout(() => {
                // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
                document.getElementById('last-update').textContent = new Date().toLocaleString('ru-RU');
                
                // –£–±–∏—Ä–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
                document.querySelector('.refresh-btn i').classList.remove('fa-spin');
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
                showNotification('–î–∞–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω—ã!', 'success');
            }, 2000);
        }

        // –§—É–Ω–∫—Ü–∏—è –ø–æ–∫–∞–∑–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
        function showNotification(message, type) {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type} alert-dismissible fade show position-fixed`;
            alertDiv.style.cssText = 'top: 20px; right: 20px; z-index: 9999; min-width: 300px;';
            alertDiv.innerHTML = `
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            
            document.body.appendChild(alertDiv);
            
            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–±–∏—Ä–∞–µ–º —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
            setTimeout(() => {
                if (alertDiv.parentNode) {
                    alertDiv.parentNode.removeChild(alertDiv);
                }
            }, 3000);
        }

        // –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç
        setInterval(() => {
            refreshData();
        }, 5 * 60 * 1000);

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', function() {
            console.log('–î–∞—à–±–æ—Ä–¥ –∑–∞–≥—Ä—É–∂–µ–Ω');
        });
    </script>
</body>
</html> 